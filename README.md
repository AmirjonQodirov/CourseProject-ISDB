# Курсовой проект по предмету Информационные системы и базы данных

### Предметная область "Производство и продажа колбасных изделий"

Представим, что нам нужно проследить путь колбасных изделий начиная от цеха по 
производству до прилавок магазинов и разных мясных лавок. 
Что из себя представляет наша предметная область: Есть много цехов где производят 
разные колбасные изделия у каждого цеха разный список продукции и каждый цех имеет 
свои фермы на разных городах и странах. В этих фермах есть разные животные включая 
экзотических животных. В зависимости от страны и города в фермах будут разводится 
разные животные включая экзотических которые доступны только в этой местности. У 
каждого цеха имеется склад в которых хранятся готовые изделия. У 
каждого цеха есть специальные люди (сотрудники цеха) которые будут поставлять разные 
колбасные изделия клиентам, под клиентами подразумевается продавец в магазине или в мясной лавке или еще где ни будь. Есть специальные лавки где продаются только 
экзотическая продукция цеха. У каждого цеха будет свой график, в зависимости от 
графика будут поставляться колбасные изделия.  Сотрудник одновременно может быть 
сотрудников нескольких цехов. В зависимости от груза (колбасных изделий) каждому 
сотруднику будет предоставлена специальная машина для перевозки груза. Город 
разделен на участки, каждый сотрудник может поставлять колбасные изделия только на 
своих участках. Продавцы могут иметь несколько поставщиков из разных цехов. Бывают 
такие случаи, когда колбасные изделия могут иметь дефекты и в этом случае продавец 
может обратно возвратить эти товары поставщикам, и поставщики в свою очередь 
цеху.  Клиент не всегда платежа способен, и поставщики чтобы не потерять клиентов 
могут отдать в долг товары. Клиенты могут сделать специальные заказы которые будут 
обрабатываться отдельно. Для сотрудников цехов и постоянных клиентов будут 
предоставлены скидки и льготные услуги на продукцию. Есть каталог подписок для 
клиентов в зависимости от подписки клиент может составить список продукции, которых 
может заказать. Для VIP клиентов у нас будет VIP подписки заказы которых будут 
обрабатываться отдельно.

### Даталогическая Модель базы данных 
![модель базы данных](https://github.com/MansurovB-source/CourseProject-ISDB/blob/main/data-model/courseworkDM.png)

### Описание основных прецедентов
Прецедент             | Добавление нового поставщика 
:-----:               | :---- 
ID                    | 1 
Краткое описание      | В таблицу Providers добавляется новый поставщик 
Главные акторы        | Администратор базы данных
Второстепенные акторы | нет
Предусловия           | Информация о человеке, фабрике, место поставки должна быть определена. О поставщика должна быть обязательно заполнена следующая информация: ссылка на человека, зарплата, ссылка на фабрику на которой он работате   
Основной поток        | <ol><li>Администратор базы данных вносит информацию об поставщике: `id_human`, `salary`, `id_factory`, `id_delivery_place`</li><li>Создается поставщик с `id_human`, `salary`, `id_factory`, `id_delivery_place`</li><li>И срабатывает триггер который увеличивает счетчик работника в таблице `factories`</li></ol>    


Прецедент             | Добавление нового клиента
:-----:               | :---- 
ID                    | 2
Краткое описание      | В таблицу Clients добавляется новый клиент 
Главные акторы        | Администратор базы данных
Второстепенные акторы | нет
Предусловия           | Информация о человеке, место поставки, подписки должна быть определена. О поставщика должна быть обязательно заполнена следующая информация: ссылка на человека, ссылка на поставщика и ссылка на подписки   
Основной поток        | <ol><li>Администратор базы данных вносит информацию об клиенте: `id_human`, `id_delivery_place`, `id_subscription`</li><li>Создается клиент с `id_human`, `id_delivery_place`, `id_subscription`</li><li>И срабатывает триггер который увеличивает счетчик клиентов в таблице `delivery_places`</li></ol>    


Прецедент             | Добавление нового заказа
:-----:               | :---- 
ID                    | 3
Краткое описание      | В таблицу Orders добавляется новый заказ
Главные акторы        | Администратор базы данных
Второстепенные акторы | нет
Предусловия           | О заказе должна быть обязательно заполнена следующая информация: клиент который заказывает, тип продукции, количество продукции в кг   
Основной поток        | <ol><li>Администратор базы данных вносит информацию об клиенте: `id_from (client)`, `id_sausage`, `sausages_weight`</li><li>Перед тем как заказ будет принять срабативает триггер `make_Schedule`. Выбирается поставщик по данному клиенту. Проверяется есть ли на складе этот продукт и если есть хватает ли его нам. Если 1 условие выполнено то изменяется количество продукции в складе. Заказ добавляется в таблицу расписаний. Триггер заполняет недостающие данные</li><li>После принятие заказа срабатывает триггер `payment`. Который добавляет запись в таблице `client_payments` и `provider_payments`</li></ol>

Прецедент             | Погашение долга (оплата) - клиент поставщику
:-----:               | :---- 
ID                    | 4 
Краткое описание      | В таблице `client_payments` изменяется запись  
Главные акторы        | Администратор базы данных
Второстепенные акторы | нет
Предусловия           | О оплате должна быть обязательно заполнена следующая информация: клиент который платит, сумма 
Основной поток        | <ol><li>Администратор базы данных вносит информацию об клиенте: `id_client`, `sum`</li><li>Перед тем как изменить запис в таблице срабатывает триггер `client_pay`. Данный триггер заполняет недостающие данные</li></ol>    

Прецедент             | Погашение долга (оплата) - поставщик цеху
:-----:               | :---- 
ID                    | 5 
Краткое описание      | В таблице `provider_payments` изменяется запись  
Главные акторы        | Администратор базы данных
Второстепенные акторы | нет
Предусловия           | О оплате должна быть обязательно заполнена следующая информация: поставщик который платит, сумма 
Основной поток        | <ol><li>Администратор базы данных вносит информацию об клиенте: `id_client`, `sum`</li><li>Перед тем как изменить запис в таблице срабатывает триггер `client_pay`. Данный триггер заполняет недостающие данные</li></ol>    
    
Прецедент             | Возврат продукта  - клиент поставщику
:-----:               | :---- 
ID                    | 6
Краткое описание      | В таблице `client_return` добавляется запись  
Главные акторы        | Администратор базы данных
Второстепенные акторы | нет
Предусловия           | О возврате должна быть обязательно заполнена следующая информация: клиент, продукция, количество в кг 
Основной поток        | <ol><li>Администратор базы данных вносит информацию об клиенте: `_from (client)`, `id_sausage`, `sausages_weight`</li><li>Перед тем как добавить  в таблице срабатывает триггер `return_client`. Данный триггер заполняет недостающие данные</li></ol>    

Прецедент             | Возврат продукта  - клиент поставщику
:-----:               | :---- 
ID                    | 7 
Краткое описание      | В таблице `provider_return` добавляется запись  
Главные акторы        | Администратор базы данных
Второстепенные акторы | нет
Предусловия           | О возврате должна быть обязательно заполнена следующая информация: поставщик, продукция, количество в кг 
Основной поток        | <ol><li>Администратор базы данных вносит информацию об клиенте: `_from (provider)`, `id_sausage`, `sausages_weight`</li><li>Перед тем как добавить  в таблице срабатывает триггер `return_client`. Данный триггер заполняет недостающие данные</li></ol>    


### Функции:
* `get_workers()` - функция позволяет получить всех своих поставщиков.
* `get_clients_for_provider(id_provider integer)` - функция позволяет получить всех клиентов определенного поставщики.
* `get_client_for_factory` - функция позволяет получить всех клиентов определенного цеха.

### Триггеры:
* `inc_DelClientNum` - триггер срабатывающий при добавление нового клиента автоматически инкрементирует счетчик клиентов в delivery_places. 
* `dec_DelClientNum` - декремент.
* `inc_WorkerNum` - триггер срабатывающий при добавление нового поставщика автоматически инкрементирует счетчик поставщиков цеха в котором работает.
* `dec_WorkerNum` - декремент.
* `make_Schedule` - триггер срабатывает при попытке сделать заказ. 
1. Есть ли на складе требуемый продукт если есть изменяеть состояние склада а если нет то заказ отменяется.
2. Заказ добавляется в расписание заказов если был принят.
* `payment` - триггер срабатывает после принятие заказа и добавляет запись в таблицу client_payments и provider_payments.
* `client_pay` - триггер срабатывает когда клиент будет оплачивать товар он изменяет таблицу client_payments заполняет поля которые не касаются клиента.
* `provider_pay` - триггер срабатывает когда поставщик будет возвращать деньги полученные от клиента цеху.
* `return_client` - триггер срабатывает когда клиент захочеть возвратить товар. Триггер заполняет нужные поля и выбирает поставщика на имя которого будет записан возврат.
* `return_provider` - триггер срабатывает когда поставщик захочеть возвратить возврат полученный от клиента  
### Индексы:
Когда клиент делает заказ срабатывают несколько триггеров, которые проверяют 
 1. есть ли в нашем складе нужное количество продукции и поэтому имеет смысл добавить индекс
 2. мы ищем есть ли запись в таблице расписание (order_schedule) и изменяем эту запись и поэтому имеет смысл добавить индекс
 
* `storages_sausage_factory`  
* `order_schedule_provider_sausage_deliv_time` - декремент.
* `return_client_from_to_sausage_rel_time` - триггер срабатывающий при добавление нового поставщика автоматически инкрементирует счетчик поставщиков цеха в котором работает.
* `return_provider_from_to_sausage_rel_time` - декремент.
